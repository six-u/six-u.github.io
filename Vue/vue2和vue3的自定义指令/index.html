<!DOCTYPE html><html lang="en" manifest="/sixu.appcache"><head><meta charset="utf-8"><meta name="keywords" content="web, 前端, JS, Vue"><meta name="description" content="技术没有边界，人也没有"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>vue2和vue3的自定义指令 | SixU 煦之</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script src="/js/pace.min.js"></script><meta name="generator" content="Hexo 5.3.0"></head><body><main class="content"><section class="outer"><article id="post-Vue/vue2和vue3的自定义指令" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">vue2和vue3的自定义指令</h1></header><div class="article-meta"><a href="/Vue/vue2%E5%92%8Cvue3%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4/" class="article-date"><time datetime="2021-01-26T14:36:07.000Z" itemprop="datePublished">2021-01-26</time></a><div class="article-category"><a class="article-category-link" href="/categories/Vue/">Vue</a></div></div><div class="tocbot"></div><div class="article-entry" itemprop="articleBody"><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>需要对普通 DOM 元素进行底层操作时，就可以用到自定义指令。</p><h2 id="不同"><a href="#不同" class="headerlink" title="不同"></a>不同</h2><h3 id="1）vue2-和-vue3-的主要区别——生命周期钩子不同："><a href="#1）vue2-和-vue3-的主要区别——生命周期钩子不同：" class="headerlink" title="1）vue2 和 vue3 的主要区别——生命周期钩子不同："></a>1）vue2 和 vue3 的主要区别——生命周期钩子不同：</h3><p>vue3：created， beforeMount， mounted，beforeUpdate， updated， beforeUnmount，unmounted</p><p>vue2：bind，inserted，update，componentUpdated，unbind</p><h3 id="2）其次是生命周期钩子函数的参数略有不同："><a href="#2）其次是生命周期钩子函数的参数略有不同：" class="headerlink" title="2）其次是生命周期钩子函数的参数略有不同："></a>2）其次是生命周期钩子函数的参数略有不同：</h3><h4 id="vue3-对应参数"><a href="#vue3-对应参数" class="headerlink" title="vue3 对应参数"></a>vue3 对应参数</h4><ol><li><strong>el</strong>：指令所绑定的元素，可以用来直接操作 DOM。</li><li><strong>binding</strong>： 一个对象，包含以下 property：<ol><li><strong>instance</strong>：使用指令的组件实例。 //</li><li><strong>value</strong>：传递给指令的值。例如，在 v-my-directive=”1 + 1” 中，该值为 2。</li><li><strong>oldValue</strong>：先前的值，仅在 beforeUpdate 和 updated 中可用。值是否已更改都可用。</li><li><strong>arg</strong>：参数传递给指令 (如果有)。例如在 v-my-directive:foo 中，arg 为 “foo”。</li><li><strong>modifiers</strong>：包含修饰符 (如果有) 的对象。例如在 v-my-directive.foo.bar 中，修饰符对象为 {foo: true，bar: true}。</li><li><strong>dir</strong>：一个对象，在注册指令时作为参数传递。例如，在以下指令中</li></ol></li><li><strong>vnode</strong>：Vue 编译生成的虚拟节点。移步 VNode API 来了解更多详情。</li><li><strong>oldVnode</strong>：上一个虚拟节点，仅在 update 和 componentUpdated 钩子中可用。</li></ol><h4 id="vue2-对应参数"><a href="#vue2-对应参数" class="headerlink" title="vue2 对应参数"></a>vue2 对应参数</h4><ol><li><strong>el</strong>：指令所绑定的元素，可以用来直接操作 DOM。</li><li><strong>binding</strong>：一个对象，包含以下 property：<ol><li><strong>name</strong>：指令名，不包括 v- 前缀。</li><li><strong>value</strong>：指令的绑定值，例如：v-my-directive=”1 + 1” 中，绑定值为 2。</li><li><strong>oldValue</strong>：指令绑定的前一个值，仅在 update 和 componentUpdated 钩子中可用。无论值是否改变都可用。</li><li><strong>expression</strong>：字符串形式的指令表达式。例如 v-my-directive=”1 + 1” 中，表达式为 “1 + 1”。</li><li><strong>arg</strong>：传给指令的参数，可选。例如 v-my-directive:foo 中，参数为 “foo”。</li><li><strong>modifiers</strong>：一个包含修饰符的对象。例如：v-my-directive.foo.bar 中，修饰符对象为 { foo: true, bar: true }。</li></ol></li><li><strong>vnode</strong>：Vue 编译生成的虚拟节点。移步 VNode API 来了解更多详情。</li><li><strong>oldVnode</strong>：上一个虚拟节点，仅在 update 和 componentUpdated 钩子中可用。</li></ol><h3 id="3）其次是简写时触发的生命周期钩子不同"><a href="#3）其次是简写时触发的生命周期钩子不同" class="headerlink" title="3）其次是简写时触发的生命周期钩子不同"></a>3）其次是简写时触发的生命周期钩子不同</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.directive(&#39;pin&#39;, (el, binding) &#x3D;&gt; &#123;</span><br><span class="line">  el.style.position &#x3D; &#39;fixed&#39;</span><br><span class="line">  const s &#x3D; binding.arg || &#39;top&#39;</span><br><span class="line">  el.style[s] &#x3D; binding.value + &#39;px&#39;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>如上写法，</p><p>在 vue3 中表示在 <strong>mounted</strong><code>和</code><strong>updated</strong> 触发回调函数的内容</p><p>在 vue2 中表示在 <strong>bind</strong><code>和</code><strong>update</strong> 触发回调函数的内容</p><h3 id="4）最后，vue3-多个根节点行为"><a href="#4）最后，vue3-多个根节点行为" class="headerlink" title="4）最后，vue3 多个根节点行为"></a>4）最后，vue3 多个根节点行为</h3><p>当在组件中使用时，<strong>自定义指令总是会被应用在组件的根节点上</strong>。当然前提条件是组件只有一个根节点。</p><p>但是 vue3 引入了多个根节点。</p><p>这时，<strong>当自定义指令被应用在一个多根节点的组件上时，指令会被忽略，并且会抛出一个警告。</strong></p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="vue3-示例"><a href="#vue3-示例" class="headerlink" title="vue3 示例"></a>vue3 示例</h3><h4 id="全局注册："><a href="#全局注册：" class="headerlink" title="全局注册："></a>全局注册：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册一个全局自定义指令 `v-focus`</span></span><br><span class="line">app.directive(<span class="string">&quot;focus&quot;</span>, &#123;</span><br><span class="line">  <span class="comment">// 当被绑定的元素挂载到 DOM 中时……</span></span><br><span class="line">  <span class="function"><span class="title">mounted</span>(<span class="params">el</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 聚焦元素</span></span><br><span class="line">    el.focus();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="局部注册："><a href="#局部注册：" class="headerlink" title="局部注册："></a>局部注册：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">directives: &#123;</span><br><span class="line">  focus: &#123;</span><br><span class="line">    <span class="comment">// 指令的定义</span></span><br><span class="line">    <span class="function"><span class="title">mounted</span>(<span class="params">el</span>)</span> &#123;</span><br><span class="line">      el.focus()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="生命周期："><a href="#生命周期：" class="headerlink" title="生命周期："></a>生命周期：</h4><p><strong>created</strong>：在绑定元素的 attribute 或事件监听器被应用之前调用。在指令需要附加须要在普通的 v-on 事件监听器前调用的事件监听器时，这很有用。</p><p><strong>beforeMount</strong>：当指令第一次绑定到元素并且在挂载父组件之前调用。</p><p><strong>mounted</strong>：在绑定元素的父组件被挂载后调用。</p><p><strong>beforeUpdate</strong>：在更新包含组件的 VNode 之前调用。</p><p><strong>updated</strong>：在包含组件的 VNode 及其子组件的 VNode 更新后调用。</p><p><strong>beforeUnmount</strong>：在卸载绑定元素的父组件之前调用</p><p><strong>unmounted</strong>：当指令与元素解除绑定且父组件已卸载时，只调用一次。</p><h3 id="vue2-示例"><a href="#vue2-示例" class="headerlink" title="vue2 示例"></a>vue2 示例</h3><h4 id="全局注册：-1"><a href="#全局注册：-1" class="headerlink" title="全局注册："></a>全局注册：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册一个全局自定义指令 `v-focus`</span></span><br><span class="line">Vue.directive(<span class="string">&quot;focus&quot;</span>, &#123;</span><br><span class="line">  <span class="comment">// 当被绑定的元素插入到 DOM 中时……</span></span><br><span class="line">  inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 聚焦元素</span></span><br><span class="line">    el.focus();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="局部注册：-1"><a href="#局部注册：-1" class="headerlink" title="局部注册："></a>局部注册：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">directives: &#123;</span><br><span class="line">  focus: &#123;</span><br><span class="line">    <span class="comment">// 指令的定义</span></span><br><span class="line">    inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">    	el.focus()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期:"></a>生命周期:</h4><p><strong>bind</strong>：只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置。</p><p><strong>inserted</strong>：被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)。</p><p><strong>update</strong>：所在组件的 VNode 更新时调用，但是可能发生在其子 VNode 更新之前。指令的值可能发生了改变，也可能没有。但是你可以通过比较更新前后的值来忽略不必要的模板更新 (详细的钩子函数参数见下)。</p><p><strong>componentUpdated</strong>：指令所在组件的 VNode 及其子 VNode 全部更新后调用。</p><p><strong>unbind</strong>：只调用一次，指令与元素解绑时调用。</p></div><footer class="article-footer"><a data-url="http://six-u.github.io/Vue/vue2%E5%92%8Cvue3%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4/" data-id="cks7lkrrm001epofe8hwaac77" class="article-share-link">分享</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/directive/" rel="tag">directive</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/vue/" rel="tag">vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/vue3/" rel="tag">vue3</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4/" rel="tag">自定义指令</a></li></ul></footer></div><div class="vcomments" id="vcomments"></div><script src="https://unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"geSruNdqLwsDxJSjaAmTiSQR-gzGzoHsz",appKey:"LmoURXO6RVhvCmEe2TBxdo8I",notify:"false",verify:"true",avatar:"mp",pageSize:"10",placeholder:"请输入..."})</script></article></section><footer class="footer" id="footer"><div class="outer"><div class="float-right"><ul class="list-inline"><li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li><li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li></ul></div><ul class="list-inline"><li>SixU 煦之 &copy; 2021</li></ul></div></footer></main><aside class="sidebar"><button class="navbar-toggle"></button><nav class="navbar"><div class="logo"><a href="/"><img src="/images/logo-s.png" alt="SixU  煦之"></a></div><ul class="nav nav-main"><li class="nav-item"><a class="nav-item-link" href="/index">首页</a></li><li class="nav-item"><a class="nav-item-link" href="/archives/">归档</a></li><li class="nav-item"><a class="nav-item-link" href="/categories/">分类</a></li><li class="nav-item"><a class="nav-item-link" href="/tags/">标签</a></li><li class="nav-item"><a class="nav-item-link" href="/muxia/">木下</a></li><li class="nav-item"><a class="nav-item-link" href="/about/">关于</a></li><li class="nav-item terminal"><a class="nav-item-link" href="/simpleConsole.html"><i class="fe fe-terminal"></i> Ter</a></li><li class="nav-item"><a class="nav-item-link" href="https://github.com/six-u" target="_blank"><i class="fe fe-github"></i> Github</a></li><li class="nav-item"><a class="nav-item-link nav-item-search" title="搜索"><i class="fe fe-search"></i> 搜索</a></li><li class="nav-item"><a target="_blank" rel="noopener" href="https://sixu-test.myshopify.com/" title="搜索"><i class="fe fe-search"></i> ddd</a></li></ul></nav><nav class="navbar navbar-bottom"><ul class="nav"><li class="nav-item"><div class="totop" id="totop"><i class="fe fe-rocket"></i></div></li></ul></nav><div class="search-form-wrap"><div class="local-search local-search-plugin"><input type="search" id="local-search-input" class="local-search-input" placeholder="Search..."><div id="local-search-result" class="local-search-result"></div></div></div></aside><script src="/js/jquery-2.0.3.min.js"></script><script src="/js/busuanzi-2.3.pure.min.js"></script><script src="/js/tocbot.min.js"></script><script>tocbot.init({tocSelector:".tocbot",contentSelector:".article-entry",headingSelector:"h1, h2, h3, h4, h5, h6",hasInnerContainers:!0,scrollSmooth:!0,positionFixedSelector:".tocbot",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"})</script><script src="/js/ocean.js"></script></body></html>