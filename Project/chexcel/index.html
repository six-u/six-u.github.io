<!DOCTYPE html><html lang="en" manifest="/sixu.appcache"><head><meta charset="utf-8"><meta name="keywords" content="web, 前端, JS, Vue"><meta name="description" content="技术没有边界，人也没有"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>chexcel | SixU 煦之</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script src="/js/pace.min.js"></script><meta name="generator" content="Hexo 5.3.0"></head><body><main class="content"><section class="outer"><article id="post-Project/chexcel" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">chexcel</h1></header><div class="article-meta"><a href="/Project/chexcel/" class="article-date"><time datetime="2020-12-17T15:15:09.000Z" itemprop="datePublished">2020-12-17</time></a><div class="article-category"><a class="article-category-link" href="/categories/Project/">Project</a></div></div><div class="tocbot"></div><div class="article-entry" itemprop="articleBody"><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>chexcel 基于 SheetJS 的 js-xlsx，官方 github: <a target="_blank" rel="noopener" href="https://github.com/SheetJS/sheetjs">https://github.com/SheetJS/sheetjs</a>，通过 js-xlsx 读取用户上传的 Excel 文件，接受用户定义的校验规则，对文件内容逐一进行对比校验，并返回校验结果。</p><p>源码位置：</p><p>github：<a target="_blank" rel="noopener" href="https://github.com/six-u/chexcel">https://github.com/six-u/chexcel</a></p><p>gitee：<a target="_blank" rel="noopener" href="https://gitee.com/six-u/chexcel">https://gitee.com/six-u/chexcel</a></p><h1 id="chexcel-使用指南"><a href="#chexcel-使用指南" class="headerlink" title="chexcel 使用指南"></a>chexcel 使用指南</h1><h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack --mode production  // 生产环境</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack --mode development // 开发环境</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><p>点击查看 <a target="_blank" rel="noopener" href="https://six-u.gitee.io/project/chexcel-demo/index.html">demo</a></p><h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p>直接引入打包生成的 js 文件，实例挂载在 window 上。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;chexcel.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chexcel.verify(file, option).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 校验结果</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><table><thead><tr><th>key</th><th>description</th><th>default</th></tr></thead><tbody><tr><td>file</td><td>需要校验的 excel 文件</td><td>无</td></tr><tr><td>option</td><td>校验规则配置，详见下</td><td>无</td></tr></tbody></table><h4 id="option"><a href="#option" class="headerlink" title="option"></a>option</h4><p>完整 option 配置示例如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">Sheet1: &#123; <span class="comment">// sheet表名</span></span><br><span class="line">    <span class="comment">// column config</span></span><br><span class="line">    columnName: &#123;  <span class="comment">// 列名</span></span><br><span class="line">      required: <span class="literal">true</span>, <span class="comment">// 是否必传，Boolean， 默认为undefined</span></span><br><span class="line">      pattern: <span class="regexp">/^[A-Z]&#123;1,2&#125;[0-9]+$/</span>,  <span class="comment">// 自定校验正则，RegExp，默认为undefined</span></span><br><span class="line">      minLength: <span class="number">5</span>, <span class="comment">// 最小字符长度，Number，默认为undefined</span></span><br><span class="line">      maxLength: <span class="number">20</span>, <span class="comment">//最大字符长度，Number，默认为undefined</span></span><br><span class="line">      length: <span class="literal">undefined</span>, <span class="comment">// 字符长度，Number，默认为undefined</span></span><br><span class="line">      min: <span class="literal">undefined</span>, <span class="comment">// 最小值，Number，默认为undefined</span></span><br><span class="line">      max: <span class="literal">undefined</span>, <span class="comment">// 最大值，Number，默认为undefined</span></span><br><span class="line">      format: <span class="literal">undefined</span>, <span class="comment">// 使用默认正则，可通过chexcel.setFormat调用添加（暂未实现），String，默认为undefined</span></span><br><span class="line">      validator: <span class="function"><span class="keyword">function</span> (<span class="params">cell, validate</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="regexp">/^[A-Z]&#123;1,2&#125;[0-9]&#123;3,7&#125;$/</span>.test(cell)) &#123;</span><br><span class="line">          validate.pattern = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="comment">// 自定义校验方法，若存在则不进行其他规则校验，Function，默认为undefined</span></span><br><span class="line">      include: <span class="literal">undefined</span>, <span class="comment">// 是否包含在给定的值中，需传入数组，Array，默认为undefined</span></span><br><span class="line">      norepeat: <span class="literal">true</span>, <span class="comment">// 列重复校验，Boolean，默认为undefined</span></span><br><span class="line">      tips: <span class="string">&quot;必填，接受5-20位字符，以1到2位大写字母开头后跟至少1位数字，且本列数据不可重复&quot;</span>,  <span class="comment">// 校验不通过时显示的提示信息，String，默认为undefined</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...  // 其他列</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ... // 其他sheet表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="validator"><a href="#validator" class="headerlink" title="validator"></a>validator</h5><p>自定义校验函数，<strong>尚不支持异步校验。</strong></p><table><thead><tr><th>params</th><th>type</th><th>description</th></tr></thead><tbody><tr><td>cell</td><td>String</td><td>当前单元格的值</td></tr><tr><td>validate</td><td>Object</td><td>校验结果</td></tr></tbody></table><p>校验结果返回，只需设置 validate 对应的属性即可，true 表示校验通过或不需校验，false 表示校验不通过，默认均为 true</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">validate = &#123;</span><br><span class="line">  required: <span class="literal">true</span>,</span><br><span class="line">  include: <span class="literal">true</span>,</span><br><span class="line">  pattern: <span class="literal">true</span>,</span><br><span class="line">  format: <span class="literal">true</span>,</span><br><span class="line">  length: <span class="literal">true</span>,</span><br><span class="line">  minLength: <span class="literal">true</span>,</span><br><span class="line">  maxLength: <span class="literal">true</span>,</span><br><span class="line">  min: <span class="literal">true</span>,</span><br><span class="line">  max: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>校验为异步校验，采用 promise 编写，需在 then 中接收校验结果。</p><p><strong>可能的情况：</strong></p><h4 id="1-没有数据"><a href="#1-没有数据" class="headerlink" title="1.没有数据"></a>1.没有数据</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    code: -<span class="number">1</span>,</span><br><span class="line">    data: <span class="string">&quot;no data&quot;</span>,</span><br><span class="line">    output: <span class="string">&quot;no data&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-配置-option-和文件表格列不匹配"><a href="#2-配置-option-和文件表格列不匹配" class="headerlink" title="2.配置 option 和文件表格列不匹配"></a>2.配置 option 和文件表格列不匹配</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    code: -<span class="number">2</span>,</span><br><span class="line">    data: <span class="string">&quot;Table column names do not match&quot;</span>,</span><br><span class="line">    output: <span class="string">&quot;Table column names do not match&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-校验通过"><a href="#3-校验通过" class="headerlink" title="3.校验通过"></a>3.校验通过</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    code: <span class="number">0</span>,</span><br><span class="line">    data: &#123;<span class="comment">/* ... */</span>&#125;,</span><br><span class="line">    output: <span class="string">&quot;All success&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-校验不通过"><a href="#4-校验不通过" class="headerlink" title="4.校验不通过"></a>4.校验不通过</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    code: <span class="number">1</span>,</span><br><span class="line">    data: &#123;<span class="comment">/* ... */</span>&#125;,</span><br><span class="line">    output: &#123;<span class="comment">/* ... */</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="data"><a href="#data" class="headerlink" title="data"></a>data</h5><p>返回校验结果原始数据，仅返回校验不通过的数据，示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	sheet表名:[</span><br><span class="line">        &#123;</span><br><span class="line">            column1:&#123;</span><br><span class="line">                <span class="comment">// line: 3,  // 校验不通过的行号（暂未添加）</span></span><br><span class="line">                format: <span class="literal">true</span>,</span><br><span class="line">                include: <span class="literal">true</span>,</span><br><span class="line">                length: <span class="literal">true</span>,</span><br><span class="line">                max: <span class="literal">true</span>,</span><br><span class="line">                maxLength: <span class="literal">true</span>,</span><br><span class="line">                min: <span class="literal">true</span>,</span><br><span class="line">                minLength: <span class="literal">true</span>,</span><br><span class="line">                norepeat: <span class="literal">true</span>,</span><br><span class="line">                pattern: <span class="literal">true</span>,</span><br><span class="line">                required: <span class="literal">false</span>, <span class="comment">// 表示必填验证未通过</span></span><br><span class="line">                tips: <span class="string">&quot;********&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// ... // 本行其他列</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// ... // 其他行</span></span><br><span class="line">	],</span><br><span class="line">    <span class="comment">// ... // 其他sheet表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="output"><a href="#output" class="headerlink" title="output"></a>output</h5><p>返回校验结果组装了提醒语句的数据，仅返回校验不通过的数据，示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	sheet表名:[</span><br><span class="line">		&#123;</span><br><span class="line">			line: <span class="number">3</span>, <span class="comment">// 校验不通过的行号</span></span><br><span class="line">			tips:[ <span class="comment">// 校验不通过的列及tips提示</span></span><br><span class="line">				&#123;</span><br><span class="line">					column: <span class="string">&quot;columnName&quot;</span></span><br><span class="line">                	tips: <span class="string">&quot;********&quot;</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="comment">// ... // 本行其他列</span></span><br><span class="line">			]</span><br><span class="line">		&#125;,</span><br><span class="line">        <span class="comment">// ... // 其他行</span></span><br><span class="line">	]，</span><br><span class="line">    <span class="comment">// ... // 其他sheet表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h3><h4 id="chexcel-setTips-tips"><a href="#chexcel-setTips-tips" class="headerlink" title="chexcel.setTips(tips)"></a>chexcel.setTips(tips)</h4><p>自定义 default tips，当校验不通过时，用于提示用户。</p><p>chexcel 内置有默认提示，但比较简单，即 tips 默认值，如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">baseTips = &#123;</span><br><span class="line">  required: <span class="string">&quot;必填&quot;</span>,</span><br><span class="line">  pattern: <span class="string">&quot;正则验证不通过&quot;</span>,</span><br><span class="line">  minLength: <span class="string">&quot;长度不够&quot;</span>,</span><br><span class="line">  maxLength: <span class="string">&quot;超出长度限制&quot;</span>,</span><br><span class="line">  length: <span class="string">&quot;长度不对&quot;</span>,</span><br><span class="line">  min: <span class="string">&quot;小于接受的最小值&quot;</span>,</span><br><span class="line">  max: <span class="string">&quot;超出接受的最大值&quot;</span>,</span><br><span class="line">  include: <span class="string">&quot;值没有包含在&quot;</span>,</span><br><span class="line">  format: <span class="string">&quot;format验证不通过&quot;</span>,</span><br><span class="line">  norepeat: <span class="string">&quot;重复数据&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>setTips 传入的 config 与默认对象采用 Object.assign(baseTips,tips)的形式合并。</p><p>优先级：chexcel.verify 传入的 tips &gt; chexcel.setTips 传入的 tips &gt; default tips</p><h4 id="chexcel-setFormat-format"><a href="#chexcel-setFormat-format" class="headerlink" title="chexcel.setFormat(format)"></a>chexcel.setFormat(format)</h4><p>用于设置默认正则，对应 chexcel.verify 传入的 option 中的 format</p><p>chexcel 内置基础 format，即：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">defaultFormat = &#123;</span><br><span class="line">  number: <span class="regexp">/^[0-9]+$/</span>,</span><br><span class="line">  email: <span class="regexp">/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/</span>,</span><br><span class="line">  tel: <span class="regexp">/^1[3456789]\d&#123;9&#125;$/</span>,</span><br><span class="line">  url: <span class="regexp">/^[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9]+\.[A-Za-z0-9-_%&amp;\?\/=]+$/</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>setFormat 传入的 format 与默认对象采用 Object.assign(defaultFormat,format)的形式合并。</p><h5 id="使用-format"><a href="#使用-format" class="headerlink" title="使用 format"></a>使用 format</h5><p>在调用 chexcel.verify 时，设置需要的各列的 format 值为对应的正则的 key 即可，如</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format: <span class="string">&quot;number&quot;</span>;</span><br></pre></td></tr></table></figure><p>表示使用 正则：**/^[0-9]+$/** 去校验该列的值</p></div><footer class="article-footer"><a data-url="http://six-u.github.io/Project/chexcel/" data-id="cks7lkrrc0015pofebhkae75z" class="article-share-link">分享</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/Excel/" rel="tag">Excel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/chexcel/" rel="tag">chexcel</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/js-xlsx/" rel="tag">js-xlsx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/%E6%A0%A1%E9%AA%8C/" rel="tag">校验</a></li></ul></footer></div><div class="vcomments" id="vcomments"></div><script src="https://unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"geSruNdqLwsDxJSjaAmTiSQR-gzGzoHsz",appKey:"LmoURXO6RVhvCmEe2TBxdo8I",notify:"false",verify:"true",avatar:"mp",pageSize:"10",placeholder:"请输入..."})</script></article></section><footer class="footer" id="footer"><div class="outer"><div class="float-right"><ul class="list-inline"><li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li><li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li></ul></div><ul class="list-inline"><li>SixU 煦之 &copy; 2021</li></ul></div></footer></main><aside class="sidebar"><button class="navbar-toggle"></button><nav class="navbar"><div class="logo"><a href="/"><img src="/images/logo-s.png" alt="SixU  煦之"></a></div><ul class="nav nav-main"><li class="nav-item"><a class="nav-item-link" href="/index">首页</a></li><li class="nav-item"><a class="nav-item-link" href="/archives/">归档</a></li><li class="nav-item"><a class="nav-item-link" href="/categories/">分类</a></li><li class="nav-item"><a class="nav-item-link" href="/tags/">标签</a></li><li class="nav-item"><a class="nav-item-link" href="/muxia/">木下</a></li><li class="nav-item"><a class="nav-item-link" href="/about/">关于</a></li><li class="nav-item terminal"><a class="nav-item-link" href="/simpleConsole.html"><i class="fe fe-terminal"></i> Ter</a></li><li class="nav-item"><a class="nav-item-link" href="https://github.com/six-u" target="_blank"><i class="fe fe-github"></i> Github</a></li><li class="nav-item"><a class="nav-item-link nav-item-search" title="搜索"><i class="fe fe-search"></i> 搜索</a></li><li class="nav-item"><a target="_blank" rel="noopener" href="https://sixu-test.myshopify.com/" title="搜索"><i class="fe fe-search"></i> ddd</a></li></ul></nav><nav class="navbar navbar-bottom"><ul class="nav"><li class="nav-item"><div class="totop" id="totop"><i class="fe fe-rocket"></i></div></li></ul></nav><div class="search-form-wrap"><div class="local-search local-search-plugin"><input type="search" id="local-search-input" class="local-search-input" placeholder="Search..."><div id="local-search-result" class="local-search-result"></div></div></div></aside><script src="/js/jquery-2.0.3.min.js"></script><script src="/js/busuanzi-2.3.pure.min.js"></script><script src="/js/tocbot.min.js"></script><script>tocbot.init({tocSelector:".tocbot",contentSelector:".article-entry",headingSelector:"h1, h2, h3, h4, h5, h6",hasInnerContainers:!0,scrollSmooth:!0,positionFixedSelector:".tocbot",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"})</script><script src="/js/ocean.js"></script></body></html>