<!DOCTYPE html><html lang="en" manifest="/sixu.appcache"><head><meta charset="utf-8"><meta name="keywords" content="web, 前端, JS, Vue"><meta name="description" content="技术没有边界，人也没有"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>http请求在网络协议层面的走向流程 | SixU 煦之</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script src="/js/pace.min.js"></script><meta name="generator" content="Hexo 5.3.0"></head><body><main class="content"><section class="outer"><article id="post-前端相关/http请求在网络协议层面的走向流程" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">http请求在网络协议层面的走向流程</h1></header><div class="article-meta"><a href="/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/http%E8%AF%B7%E6%B1%82%E5%9C%A8%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%B1%82%E9%9D%A2%E7%9A%84%E8%B5%B0%E5%90%91%E6%B5%81%E7%A8%8B/" class="article-date"><time datetime="2021-02-07T13:33:17.000Z" itemprop="datePublished">2021-02-07</time></a><div class="article-category"><a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/">前端相关</a></div></div><div class="tocbot"></div><div class="article-entry" itemprop="articleBody"><h2 id="简要流程"><a href="#简要流程" class="headerlink" title="简要流程"></a>简要流程</h2><ol><li>通过 DNS 域名解析由域名获得服务器 IP 地址</li><li>通过 IP 寻址找到目标服务器</li><li>通过 TCP 协议建立链接</li><li>通过 HTTP 协议发送业务数据</li></ol><h2 id="一、寻址"><a href="#一、寻址" class="headerlink" title="一、寻址"></a>一、寻址</h2><h3 id="1-DNS-域名解析获取目标服务器-IP"><a href="#1-DNS-域名解析获取目标服务器-IP" class="headerlink" title="1. DNS 域名解析获取目标服务器 IP"></a>1. DNS 域名解析获取目标服务器 IP</h3><ol><li>查看浏览器是否缓存域名对应 IP</li><li>查看本机是否缓存，可通过在 cmd 中输入 ipconfig /displaydns 查看</li><li>查看本机 host 文件，win：C:\Windows\System32\drivers\etc\ hosts</li><li>查询本地域名解析服务器，即在本机网络配置中配置的 dns(配置 IP 的地方)。如：本地局域网网关的缓存，或者直接是电信等运行商部署在当地的 nds 服务器的缓存</li><li>查询 DNS 根域名解析服务器，根服务器只保存其下一级域名服务器地址，于是分发给下一级的顶级服务器</li><li>查询顶级服务器</li><li>查询二级服务器</li><li>以此类推，最终获得 IP 地址。</li><li>注：以上任意一步找到 IP，都会直接返回本机，不再向下查询。</li></ol><h3 id="2-IP-寻址找到目标服务器"><a href="#2-IP-寻址找到目标服务器" class="headerlink" title="2. IP 寻址找到目标服务器"></a>2. IP 寻址找到目标服务器</h3><ol><li>通过IP协议找到目标服务器，IP 协议的目的是实现网络层的数据转发，它通过路由器不断跳转，最终把数据成功送达目的地。</li><li>发送一个 IP 请求的过程：<ol><li>构建 IP 请求头</li><li>IP 协议通过 IP 寻址算法，找出一条通往目标服务器的路线</li><li>IP 寻址算法其实就是一种最短路径算法，两种实现：<ol><li>RIP 协议（确保 IP 路由跳转的次数最小）</li><li>OSPF 协议（确保 IP 路由跳转的速度最快）</li></ol></li></ol></li><li>发送端查询路由表，找出下一跳 （一般就是路由器） 的 IP 地址，并发送数据</li><li>路由器查询路由表，继续找出下一跳的 IP 地址，并发送数据，</li><li>如此往复，直到找到目的服务器，发送数据。</li></ol><p><img src="https://gitee.com/six-u/gallery/raw/master/wallpaper/http1.png" alt="image"></p><ol start="3"><li>Mac 寻址找到服务器硬件接口<ol><li>IP 协议主要是用来寻找最优路径的，具体的传输是由以太网协议来做的</li><li>以太网属于数据链路层，它主要负责相邻设备的通信。原理是通过查询交换机 Mac 表，找到通信双方的物理接口，进而开始通信。</li></ol></li><li>通过有线网络或无线网络箱服务器硬件接口传输比特信息，光纤：光信号，电缆：电信号</li></ol><h2 id="二、建立-TCP-链接"><a href="#二、建立-TCP-链接" class="headerlink" title="二、建立 TCP 链接"></a>二、建立 TCP 链接</h2><ol><li><p>找到目标服务器后，通过 TCP 3 次握手建立连接</p></li><li><p>TCP 报文头</p></li></ol><p><img src="https://gitee.com/six-u/gallery/raw/master/wallpaper/http2.png"></p><ol start="3"><li>TCP 三次握手过程</li></ol><p><img src="https://gitee.com/six-u/gallery/raw/master/wallpaper/http3.png"></p><ol start="4"><li>每一次 TCP 握手以及数据交互，都是通过 IP 协议去传输的</li></ol><h2 id="三-发送数据"><a href="#三-发送数据" class="headerlink" title="三. 发送数据"></a>三. 发送数据</h2><h3 id="1-建立安全层-SSL"><a href="#1-建立安全层-SSL" class="headerlink" title="1. 建立安全层 SSL"></a>1. 建立安全层 SSL</h3><ol><li><p>发送一个 HTTPS 的请求，所以在发送数据之前，会创建一个 SSL 安全层，用于数据加密。</p><ol><li>对称加密</li><li>非对称加密</li></ol></li><li><p>目前方案：先使用非对称加密，进行秘钥协商，让通信双方拿到相同的钥匙。 然后使用对称加密，进行加密传输。</p><ol><li><p>密钥协商过程：</p><p><img src="https://gitee.com/six-u/gallery/raw/master/wallpaper/http4.png"></p></li><li><p>说明：</p><ol><li>客户端发送自身支持的加密算法。</li><li>服务器端选择一种加密算法，同时返回数字证书。</li><li>客户端确认证书有效。</li><li>客户端生成随机数，并使用证书中的服务器公钥加密，然后发送给服务器。</li><li>服务器端使用私钥解密，获得随机数。</li><li>双方使用第 2 步确定的加密算法，把随机数进行加密，即可获得相同的对称加密秘钥。</li></ol></li></ol></li><li><p>数字证书确保密钥协商是与服务端通信，而非中间人。</p><p>!<img src="https://gitee.com/six-u/gallery/raw/master/wallpaper/http5.png"></p><p><img src="https://gitee.com/six-u/gallery/raw/master/wallpaper/http6.png"></p></li><li><p>秘钥协商之后，SSL 安全层就建好了</p></li></ol><h3 id="2-发送-http-请求"><a href="#2-发送-http-请求" class="headerlink" title="2. 发送 http 请求"></a>2. 发送 http 请求</h3><ol><li>HTTP 协议其实就是制定了一个通信规则，规定了客户端和服务器之间的通信格式。</li><li>发起 HTTP 请求时，必须遵守以下规则：<ol><li>请求方法（必填） GET</li><li>请求地址（必填） /</li><li>HTTP 协议版本（必填） 1.1</li><li>其他 HTTP 头部字段（可选） Host、User-Agent、Accept</li><li>请求参数，放在空行后面（可选）</li></ol></li><li>服务器响应请求时，同样遵守了 HTTP 响应规则：<ol><li>HTTP 协议版本（必填） 1.1</li><li>响应状态码（必填） 200</li><li>状态码描述（必填） OK</li><li>其他 HTTP 头部字段（可选） Date、Server、ETag、Last-Modified 等</li><li>请求参数，放在空行后面（可选）</li></ol></li><li>只要我们遵守这个规则，就能进行 HTTP 通信了。</li></ol><hr><blockquote><p>主要内容整理自 360 前端团队-奇舞团 公众号</p></blockquote></div><footer class="article-footer"><a data-url="http://six-u.github.io/%E5%89%8D%E7%AB%AF%E7%9B%B8%E5%85%B3/http%E8%AF%B7%E6%B1%82%E5%9C%A8%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%B1%82%E9%9D%A2%E7%9A%84%E8%B5%B0%E5%90%91%E6%B5%81%E7%A8%8B/" data-id="cks7lkrst002dpofecejj3s8w" class="article-share-link">分享</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/DNS/" rel="tag">DNS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/IP/" rel="tag">IP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/SSL/" rel="tag">SSL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/TCP/" rel="tag">TCP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/http/" rel="tag">http</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/https/" rel="tag">https</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag-list/%E5%8A%A0%E5%AF%86/" rel="tag">加密</a></li></ul></footer></div><div class="vcomments" id="vcomments"></div><script src="https://unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"geSruNdqLwsDxJSjaAmTiSQR-gzGzoHsz",appKey:"LmoURXO6RVhvCmEe2TBxdo8I",notify:"false",verify:"true",avatar:"mp",pageSize:"10",placeholder:"请输入..."})</script></article></section><footer class="footer" id="footer"><div class="outer"><div class="float-right"><ul class="list-inline"><li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li><li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li></ul></div><ul class="list-inline"><li>SixU 煦之 &copy; 2021</li></ul></div></footer></main><aside class="sidebar"><button class="navbar-toggle"></button><nav class="navbar"><div class="logo"><a href="/"><img src="/images/logo-s.png" alt="SixU  煦之"></a></div><ul class="nav nav-main"><li class="nav-item"><a class="nav-item-link" href="/index">首页</a></li><li class="nav-item"><a class="nav-item-link" href="/archives/">归档</a></li><li class="nav-item"><a class="nav-item-link" href="/categories/">分类</a></li><li class="nav-item"><a class="nav-item-link" href="/tags/">标签</a></li><li class="nav-item"><a class="nav-item-link" href="/muxia/">木下</a></li><li class="nav-item"><a class="nav-item-link" href="/about/">关于</a></li><li class="nav-item terminal"><a class="nav-item-link" href="/simpleConsole.html"><i class="fe fe-terminal"></i> Ter</a></li><li class="nav-item"><a class="nav-item-link" href="https://github.com/six-u" target="_blank"><i class="fe fe-github"></i> Github</a></li><li class="nav-item"><a class="nav-item-link nav-item-search" title="搜索"><i class="fe fe-search"></i> 搜索</a></li><li class="nav-item"><a target="_blank" rel="noopener" href="https://sixu-test.myshopify.com/" title="搜索"><i class="fe fe-search"></i> ddd</a></li></ul></nav><nav class="navbar navbar-bottom"><ul class="nav"><li class="nav-item"><div class="totop" id="totop"><i class="fe fe-rocket"></i></div></li></ul></nav><div class="search-form-wrap"><div class="local-search local-search-plugin"><input type="search" id="local-search-input" class="local-search-input" placeholder="Search..."><div id="local-search-result" class="local-search-result"></div></div></div></aside><script src="/js/jquery-2.0.3.min.js"></script><script src="/js/busuanzi-2.3.pure.min.js"></script><script src="/js/tocbot.min.js"></script><script>tocbot.init({tocSelector:".tocbot",contentSelector:".article-entry",headingSelector:"h1, h2, h3, h4, h5, h6",hasInnerContainers:!0,scrollSmooth:!0,positionFixedSelector:".tocbot",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"})</script><script src="/js/ocean.js"></script></body></html>